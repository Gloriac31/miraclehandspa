---
// Square Booking Modal Component
---

<div id="square-booking-modal" class="hidden fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black bg-opacity-80">
    <div class="relative w-full max-w-4xl h-[90vh] max-h-[800px] bg-white rounded-xl shadow-2xl overflow-hidden">
        <button 
            id="close-square-modal"
            class="absolute top-4 right-4 z-50 bg-gray-800 text-white w-10 h-10 rounded-full flex items-center justify-center text-2xl hover:bg-gray-600 transition-colors"
            aria-label="Close booking modal"
        >
            Ã—
        </button>
        <div id="square-widget-container" class="w-full h-full overflow-auto">
            <!-- Square widget will be loaded here by the script -->
            <div id="square-appointments-widget"></div>
        </div>
    </div>
</div>

<!-- Square Appointments Widget Script -->
<script is:inline src='https://app.squareup.com/appointments/buyer/widget/l869rjoioj715u/H9A47D0JX2NAJ.js'></script>

<script>
    // Function to open Square booking modal
    function openSquareBooking() {
        const modal = document.getElementById('square-booking-modal');
        const container = document.getElementById('square-widget-container');
        
        if (modal && container) {
            // Show the modal
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // The Square widget script should automatically create the booking interface
            // Wait for it to load and try to find/move it to our container
            const checkForWidget = setInterval(() => {
                // Look for Square widget elements that the script creates
                const squareWidget = document.querySelector('iframe[src*="squareup.com"], [data-square-appointments], div[id*="square-appointments"]');
                
                if (squareWidget) {
                    clearInterval(checkForWidget);
                    
                    // Move widget to our container if it's not already there
                    if (squareWidget.parentElement !== container) {
                        container.innerHTML = '';
                        container.appendChild(squareWidget);
                    }
                }
            }, 200);
            
            // Stop checking after 5 seconds
            setTimeout(() => {
                clearInterval(checkForWidget);
                
                // If widget still not found, show fallback link
                if (!container.querySelector('iframe, [data-square-appointments]')) {
                    container.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full p-8">
                            <p class="text-gray-600 mb-4 text-center">Click below to book your appointment</p>
                            <a href="https://app.squareup.com/appointments/buyer/widget/l869rjoioj715u/H9A47D0JX2NAJ" 
                               target="_blank" 
                               class="bg-primary text-white px-8 py-4 rounded-lg font-medium hover:bg-blue-600 transition-colors">
                                Book an Appointment
                            </a>
                        </div>
                    `;
                }
            }, 5000);
        }
    }

    // Function to close Square booking modal (kept for compatibility)
    function closeSquareBooking() {
        const modal = document.getElementById('square-booking-modal');
        if (modal) {
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }
    }

    // Make functions globally available
    (window as any).openSquareBooking = openSquareBooking;
    (window as any).closeSquareBooking = closeSquareBooking;

    // Close button handler (for iframe approach if needed later)
    document.addEventListener('DOMContentLoaded', () => {
        const closeButton = document.getElementById('close-square-modal');
        const modal = document.getElementById('square-booking-modal');
        
        if (closeButton) {
            closeButton.addEventListener('click', closeSquareBooking);
        }

        // Close modal when clicking outside
        if (modal) {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeSquareBooking();
                }
            });
        }

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal && !modal.classList.contains('hidden')) {
                closeSquareBooking();
            }
        });
    });
</script>

